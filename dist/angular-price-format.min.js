angular.module("angular-price-format",[]).directive("pformat",[function(){return{require:"?ngModel",link:function(a,b,c,d){d&&(d.$formatters.unshift(function(){return b[0].value=100*d.$modelValue,b.priceFormat({prefix:"undefined"==typeof c.prefix?"":c.prefix,centsSeparator:"undefined"==typeof c.cents?",":c.cents,thousandsSeparator:"undefined"==typeof c.thousands?".":c.thousands}),b[0].value}),d.$parsers.unshift(function(){return b.priceFormat({prefix:"undefined"==typeof c.prefix?"":c.prefix,centsSeparator:"undefined"==typeof c.cents?",":c.cents,thousandsSeparator:"undefined"==typeof c.thousands?".":c.thousands}),b[0].value}))}}}]),function(a){a.fn.priceFormat=function(b){var c={prefix:"US$ ",suffix:"",centsSeparator:".",thousandsSeparator:",",limit:!1,centsLimit:2,clearPrefix:!1,clearSufix:!1,allowNegative:!1,insertPlusSign:!1},b=a.extend(c,b);return this.each(function(){function c(a){for(var b="",c=0;c<a.length;c++)char_=a.charAt(c),0==b.length&&0==char_&&(char_=!1),char_&&char_.match(m)&&(r?b.length<r&&(b+=char_):b+=char_);return b}function d(a){for(;a.length<s+1;)a="0"+a;return a}function e(b){var e=d(c(b)),f="",g=0;0==s&&(p="",h="");var h=e.substr(e.length-s,s),i=e.substr(0,e.length-s);if(e=0==s?i:i+p+h,q||""!=a.trim(q)){for(var j=i.length;j>0;j--)char_=i.substr(j-1,1),g++,g%3==0&&(char_=q+char_),f=char_+f;f.substr(0,1)==q&&(f=f.substring(1,f.length)),e=0==s?f:f+p+h}return!v||0==i&&0==h||(e=-1!=b.indexOf("-")&&b.indexOf("+")<b.indexOf("-")?"-"+e:w?"+"+e:""+e),n&&(e=n+e),o&&(e+=o),e}function f(a){var b=a.keyCode?a.keyCode:a.which,c=String.fromCharCode(b),d=!1,f=l.val(),g=e(f+c);(b>=48&&57>=b||b>=96&&105>=b)&&(d=!0),8==b&&(d=!0),9==b&&(d=!0),13==b&&(d=!0),46==b&&(d=!0),37==b&&(d=!0),39==b&&(d=!0),!v||189!=b&&109!=b||(d=!0),!w||187!=b&&107!=b||(d=!0),d||(a.preventDefault(),a.stopPropagation(),f!=g&&l.val(g))}function g(){var a=l.val(),b=e(a);a!=b&&l.val(b)}function h(){var a=l.val();l.val(n+a)}function i(){var a=l.val();l.val(a+o)}function j(){if(""!=a.trim(n)&&t){var b=l.val().split(n);l.val(b[1])}}function k(){if(""!=a.trim(o)&&u){var b=l.val().split(o);l.val(b[0])}}var l=a(this),m=/[0-9]/,n=b.prefix,o=b.suffix,p=b.centsSeparator,q=b.thousandsSeparator,r=b.limit,s=b.centsLimit,t=b.clearPrefix,u=b.clearSuffix,v=b.allowNegative,w=b.insertPlusSign;w&&(v=!0),a(this).bind("keydown.price_format",f),a(this).bind("keyup.price_format",g),a(this).bind("focusout.price_format",g),t&&(a(this).bind("focusout.price_format",function(){j()}),a(this).bind("focusin.price_format",function(){h()})),u&&(a(this).bind("focusout.price_format",function(){k()}),a(this).bind("focusin.price_format",function(){i()})),a(this).val().length>0&&(g(),j(),k())})},a.fn.unpriceFormat=function(){return a(this).unbind(".price_format")},a.fn.unmask=function(){var b=a(this).val(),c="";for(var d in b)isNaN(b[d])&&"-"!=b[d]||(c+=b[d]);return c}}(jQuery);